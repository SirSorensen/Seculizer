// Vitest Snapshot v1

exports[`should parse Clear.sepo 1`] = `
{
  "equations": undefined,
  "format": undefined,
  "functions": undefined,
  "icons": undefined,
  "keyRelations": undefined,
  "knowledge": {
    "knowledge": [
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "key",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "key",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "knowledgeItem",
      },
    ],
    "type": "knowledge",
  },
  "participants": {
    "participants": [
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "participantItem",
      },
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "participantItem",
      },
    ],
    "type": "participants",
  },
  "protocol": {
    "statements": [
      {
        "child": {
          "id": {
            "type": "id",
            "value": "key",
          },
          "type": "clearStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
    ],
    "type": "protocol",
  },
  "type": "program",
}
`;

exports[`should parse Diffie-hellman.sepo 1`] = `
{
  "equations": {
    "equations": [
      {
        "left": {
          "id": "exp",
          "params": [
            {
              "id": "exp",
              "params": [
                {
                  "type": "id",
                  "value": "g",
                },
                {
                  "type": "id",
                  "value": "Y",
                },
              ],
              "type": "function",
            },
            {
              "type": "id",
              "value": "X",
            },
          ],
          "type": "function",
        },
        "right": {
          "id": "exp",
          "params": [
            {
              "id": "exp",
              "params": [
                {
                  "type": "id",
                  "value": "g",
                },
                {
                  "type": "id",
                  "value": "X",
                },
              ],
              "type": "function",
            },
            {
              "type": "id",
              "value": "Y",
            },
          ],
          "type": "function",
        },
        "type": "equation",
      },
    ],
    "type": "equations",
  },
  "format": {
    "formats": [
      {
        "format": {
          "type": "latex",
          "value": "$x^y$",
        },
        "id": {
          "id": "exp",
          "params": [
            {
              "type": "id",
              "value": "x",
            },
            {
              "type": "id",
              "value": "y",
            },
          ],
          "type": "function",
        },
        "type": "formatItem",
      },
    ],
    "type": "format",
  },
  "functions": undefined,
  "icons": {
    "icons": Map {
      "Alice" => "woman",
      "Bob" => "man",
      "X" => "üîë",
      "Y" => "üîë",
      "g" => "gear",
      "msgA" => "üìù",
      "msgB" => "üìù",
    },
    "type": "icons",
  },
  "keyRelations": undefined,
  "knowledge": {
    "knowledge": [
      {
        "children": [
          {
            "comment": {
              "type": "stmtComment",
              "value": {
                "type": "string",
                "value": "This is an nonce",
              },
            },
            "value": {
              "type": "id",
              "value": "X",
            },
          },
          {
            "comment": {
              "type": "stmtComment",
              "value": {
                "type": "string",
                "value": "This is Alice's message",
              },
            },
            "value": {
              "type": "id",
              "value": "msgA",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": {
              "type": "stmtComment",
              "value": {
                "type": "string",
                "value": "This is a random number",
              },
            },
            "value": {
              "type": "id",
              "value": "Y",
            },
          },
          {
            "comment": {
              "type": "stmtComment",
              "value": {
                "type": "string",
                "value": "This is Bob's message",
              },
            },
            "value": {
              "type": "id",
              "value": "msgB",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": {
              "type": "stmtComment",
              "value": {
                "type": "string",
                "value": "This is a generator",
              },
            },
            "value": {
              "type": "id",
              "value": "g",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Shared",
        },
        "type": "knowledgeItem",
      },
    ],
    "type": "knowledge",
  },
  "participants": {
    "participants": [
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "participantItem",
      },
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "participantItem",
      },
    ],
    "type": "participants",
  },
  "protocol": {
    "statements": [
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "id": "exp",
                  "params": [
                    {
                      "type": "id",
                      "value": "g",
                    },
                    {
                      "type": "id",
                      "value": "X",
                    },
                  ],
                  "type": "function",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Alice",
          },
          "rightId": {
            "type": "id",
            "value": "Bob",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Alice sends Bob her public key",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "id": "exp",
                  "params": [
                    {
                      "type": "id",
                      "value": "g",
                    },
                    {
                      "type": "id",
                      "value": "Y",
                    },
                  ],
                  "type": "function",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Bob",
          },
          "rightId": {
            "type": "id",
            "value": "Alice",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Bob sends Alice his public key",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "id",
                        "value": "msgA",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "id": "exp",
                    "params": [
                      {
                        "id": "exp",
                        "params": [
                          {
                            "type": "id",
                            "value": "g",
                          },
                          {
                            "type": "id",
                            "value": "X",
                          },
                        ],
                        "type": "function",
                      },
                      {
                        "type": "id",
                        "value": "Y",
                      },
                    ],
                    "type": "function",
                  },
                  "type": "encryptExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Alice",
          },
          "rightId": {
            "type": "id",
            "value": "Bob",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Alice sends Bob a message encrypted with Bob's public key",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "id",
                        "value": "msgB",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "id": "exp",
                    "params": [
                      {
                        "id": "exp",
                        "params": [
                          {
                            "type": "id",
                            "value": "g",
                          },
                          {
                            "type": "id",
                            "value": "X",
                          },
                        ],
                        "type": "function",
                      },
                      {
                        "type": "id",
                        "value": "Y",
                      },
                    ],
                    "type": "function",
                  },
                  "type": "encryptExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Bob",
          },
          "rightId": {
            "type": "id",
            "value": "Alice",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Bob sends Alice a message encrypted with Alice's public key",
          },
        },
        "type": "statement",
      },
    ],
    "type": "protocol",
  },
  "type": "program",
}
`;

exports[`should parse Envelope.sepo 1`] = `
{
  "equations": undefined,
  "format": {
    "formats": [
      {
        "format": {
          "type": "latex",
          "value": "$H(x||y)$",
        },
        "id": {
          "id": "hash",
          "params": [
            {
              "type": "id",
              "value": "x",
            },
            {
              "type": "id",
              "value": "y",
            },
          ],
          "type": "function",
        },
        "type": "formatItem",
      },
      {
        "format": {
          "type": "latex",
          "value": "$tpm_{sk}$",
        },
        "id": {
          "type": "id",
          "value": "tpm_sk",
        },
        "type": "formatItem",
      },
      {
        "format": {
          "type": "latex",
          "value": "$tpm_{pk}$",
        },
        "id": {
          "type": "id",
          "value": "tpm_pk",
        },
        "type": "formatItem",
      },
      {
        "format": {
          "type": "latex",
          "value": "$\\\\textbf{pcr}$",
        },
        "id": {
          "type": "id",
          "value": "pcr",
        },
        "type": "formatItem",
      },
    ],
    "type": "format",
  },
  "functions": {
    "functions": [
      {
        "type": "id",
        "value": "hash",
      },
    ],
    "type": "functionsDef",
  },
  "icons": {
    "icons": Map {
      "Alice" => "woman",
      "Parent" => "family",
      "tpm_pk" => "üîë",
      "tpm_sk" => "üîë",
      "k" => "üîë",
      "esk" => "üîë",
      "pcr" => "üìù",
      "v" => "üìù",
      "sid" => "input-numbers",
      "n" => "input-numbers",
      "TPM" => "save",
    },
    "type": "icons",
  },
  "keyRelations": {
    "keyRelations": [
      {
        "pk": {
          "type": "id",
          "value": "tpm_pk",
        },
        "sk": {
          "type": "id",
          "value": "tpm_sk",
        },
        "type": "keyRelation",
      },
    ],
    "type": "keyRelations",
  },
  "knowledge": {
    "knowledge": [
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "tpm_sk",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "TPM",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "tpm_pk",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Shared",
        },
        "type": "knowledgeItem",
      },
    ],
    "type": "knowledge",
  },
  "participants": {
    "participants": [
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "participantItem",
      },
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Parent",
        },
        "type": "participantItem",
      },
      {
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Trusted Platform Module, a secure cryptoprocessor",
          },
        },
        "id": {
          "type": "id",
          "value": "TPM",
        },
        "type": "participantItem",
      },
    ],
    "type": "participants",
  },
  "protocol": {
    "statements": [
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "string",
                  "value": "\\"Boot\\"",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Alice",
          },
          "rightId": {
            "type": "id",
            "value": "TPM",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Alice boots the TPM",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "id": {
              "type": "id",
              "value": "pcr",
            },
            "type": "setStatement",
            "value": {
              "type": "number",
              "value": 1,
            },
          },
          "id": {
            "type": "id",
            "value": "TPM",
          },
          "type": "participantStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "The TPM initilize PCR to 1",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "string",
                  "value": "\\"Booted\\"",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "TPM",
          },
          "rightId": {
            "type": "id",
            "value": "Alice",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "comment": {
              "type": "stmtComment",
              "value": {
                "type": "string",
                "value": "Nonce",
              },
            },
            "type": "newStatement",
            "value": {
              "type": "id",
              "value": "n",
            },
          },
          "id": {
            "type": "id",
            "value": "Alice",
          },
          "type": "participantStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "A new nonce is generated",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "comment": undefined,
            "type": "newStatement",
            "value": {
              "type": "id",
              "value": "esk",
            },
          },
          "id": {
            "type": "id",
            "value": "Alice",
          },
          "type": "participantStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "A new session key is generated",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "string",
                  "value": "\\"Session\\"",
                },
                "type": "expression",
              },
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "id",
                        "value": "esk",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "tpm_pk",
                  },
                  "type": "encryptExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Alice",
          },
          "rightId": {
            "type": "id",
            "value": "TPM",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Alice sends the TPM a session key encrypted with the TPM's public key",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "comment": undefined,
            "type": "newStatement",
            "value": {
              "type": "id",
              "value": "sid",
            },
          },
          "id": {
            "type": "id",
            "value": "TPM",
          },
          "type": "participantStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "The TPM generates a new session id",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "id",
                  "value": "sid",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "TPM",
          },
          "rightId": {
            "type": "id",
            "value": "Alice",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "The TPM sends the session id to Alice",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "string",
                        "value": "\\"Extend\\"",
                      },
                      "type": "expression",
                    },
                    {
                      "child": {
                        "type": "id",
                        "value": "n",
                      },
                      "type": "expression",
                    },
                    {
                      "child": {
                        "type": "id",
                        "value": "sid",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "esk",
                  },
                  "type": "encryptExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Alice",
          },
          "rightId": {
            "type": "id",
            "value": "TPM",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Alice extends the PCR with the nonce and the session id",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "id": {
              "type": "id",
              "value": "pcr",
            },
            "type": "setStatement",
            "value": {
              "id": "hash",
              "params": [
                {
                  "type": "id",
                  "value": "n",
                },
                {
                  "type": "id",
                  "value": "pcr",
                },
              ],
              "type": "function",
            },
          },
          "id": {
            "type": "id",
            "value": "TPM",
          },
          "type": "participantStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "The TPM extends the PCR",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "string",
                  "value": "\\"Extended\\"",
                },
                "type": "expression",
              },
              {
                "child": {
                  "type": "id",
                  "value": "pcr",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "TPM",
          },
          "rightId": {
            "type": "id",
            "value": "Alice",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "The TPM sends the new PCR to Alice",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "string",
                  "value": "\\"Create\\"",
                },
                "type": "expression",
              },
              {
                "child": {
                  "id": "hash",
                  "params": [
                    {
                      "type": "id",
                      "value": "obt",
                    },
                    {
                      "type": "id",
                      "value": "pcr",
                    },
                  ],
                  "type": "function",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Alice",
          },
          "rightId": {
            "type": "id",
            "value": "TPM",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Alice requests the TPM to create a new key",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "comment": undefined,
            "type": "newStatement",
            "value": {
              "type": "id",
              "value": "k",
            },
          },
          "id": {
            "type": "id",
            "value": "TPM",
          },
          "type": "participantStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "The TPM generates a new key",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "string",
                        "value": "\\"Created\\"",
                      },
                      "type": "expression",
                    },
                    {
                      "child": {
                        "type": "id",
                        "value": "k",
                      },
                      "type": "expression",
                    },
                    {
                      "child": {
                        "id": "hash",
                        "params": [
                          {
                            "type": "id",
                            "value": "obt",
                          },
                          {
                            "type": "id",
                            "value": "pcr",
                          },
                        ],
                        "type": "function",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "tpm_sk",
                  },
                  "type": "signExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "TPM",
          },
          "rightId": {
            "type": "id",
            "value": "Alice",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "The TPM sends the new key and the PCR to Alice",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "id": {
            "type": "id",
            "value": "sid",
          },
          "type": "clearStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "The session key and the session id are cleared",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "comment": undefined,
            "type": "newStatement",
            "value": {
              "type": "id",
              "value": "v",
            },
          },
          "id": {
            "type": "id",
            "value": "Alice",
          },
          "type": "participantStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Alice creates an abilitry value",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "string",
                  "value": "\\"Envelope\\"",
                },
                "type": "expression",
              },
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "id",
                        "value": "v",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "k",
                  },
                  "type": "encryptExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Alice",
          },
          "rightId": {
            "type": "id",
            "value": "Parent",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Alice sends the abilitry value encrypted with the new key to the parent",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "comment": undefined,
            "type": "newStatement",
            "value": {
              "type": "id",
              "value": "esk",
            },
          },
          "id": {
            "type": "id",
            "value": "Parent",
          },
          "type": "participantStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "The parent generates a new session key",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "string",
                  "value": "\\"Session\\"",
                },
                "type": "expression",
              },
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "id",
                        "value": "esk",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "tpm_pk",
                  },
                  "type": "encryptExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Parent",
          },
          "rightId": {
            "type": "id",
            "value": "TPM",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "The parent sends the TPM a session key encrypted with the TPM's public key",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "comment": undefined,
            "type": "newStatement",
            "value": {
              "type": "id",
              "value": "sid",
            },
          },
          "id": {
            "type": "id",
            "value": "TPM",
          },
          "type": "participantStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "The TPM generates a new session id",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "id",
                  "value": "sid",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "TPM",
          },
          "rightId": {
            "type": "id",
            "value": "Parent",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "The TPM sends the session id to the parent",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "cases": [
              {
                "case": {
                  "type": "string",
                  "value": "\\"Refuse\\"",
                },
                "children": [
                  {
                    "child": {
                      "child": {
                        "expressions": [
                          {
                            "child": {
                              "inner": [
                                {
                                  "child": {
                                    "type": "string",
                                    "value": "\\"Extend\\"",
                                  },
                                  "type": "expression",
                                },
                                {
                                  "child": {
                                    "type": "string",
                                    "value": "\\"ref\\"",
                                  },
                                  "type": "expression",
                                },
                                {
                                  "child": {
                                    "type": "id",
                                    "value": "sid",
                                  },
                                  "type": "expression",
                                },
                              ],
                              "outer": {
                                "type": "id",
                                "value": "esk",
                              },
                              "type": "encryptExpression",
                            },
                            "type": "expression",
                          },
                        ],
                        "type": "messageSendStatement",
                      },
                      "leftId": {
                        "type": "id",
                        "value": "Parent",
                      },
                      "rightId": {
                        "type": "id",
                        "value": "TPM",
                      },
                      "type": "sendStatement",
                    },
                    "comment": {
                      "type": "stmtComment",
                      "value": {
                        "type": "string",
                        "value": "The parent requests the TPM to extend the PCR with the refusal value and the session id",
                      },
                    },
                    "type": "statement",
                  },
                  {
                    "child": {
                      "child": {
                        "id": {
                          "type": "id",
                          "value": "pcr",
                        },
                        "type": "setStatement",
                        "value": {
                          "id": "hash",
                          "params": [
                            {
                              "type": "string",
                              "value": "\\"ref\\"",
                            },
                            {
                              "type": "id",
                              "value": "pcr",
                            },
                          ],
                          "type": "function",
                        },
                      },
                      "id": {
                        "type": "id",
                        "value": "TPM",
                      },
                      "type": "participantStatement",
                    },
                    "comment": {
                      "type": "stmtComment",
                      "value": {
                        "type": "string",
                        "value": "The TPM extends the PCR",
                      },
                    },
                    "type": "statement",
                  },
                  {
                    "child": {
                      "child": {
                        "expressions": [
                          {
                            "child": {
                              "type": "string",
                              "value": "\\"Extended\\"",
                            },
                            "type": "expression",
                          },
                          {
                            "child": {
                              "type": "id",
                              "value": "pcr",
                            },
                            "type": "expression",
                          },
                        ],
                        "type": "messageSendStatement",
                      },
                      "leftId": {
                        "type": "id",
                        "value": "TPM",
                      },
                      "rightId": {
                        "type": "id",
                        "value": "Parent",
                      },
                      "type": "sendStatement",
                    },
                    "comment": {
                      "type": "stmtComment",
                      "value": {
                        "type": "string",
                        "value": "The TPM sends the new PCR to the parent",
                      },
                    },
                    "type": "statement",
                  },
                  {
                    "child": {
                      "child": {
                        "expressions": [
                          {
                            "child": {
                              "type": "string",
                              "value": "\\"Quote\\"",
                            },
                            "type": "expression",
                          },
                          {
                            "child": {
                              "inner": [
                                {
                                  "child": {
                                    "type": "id",
                                    "value": "v",
                                  },
                                  "type": "expression",
                                },
                              ],
                              "outer": {
                                "type": "id",
                                "value": "k",
                              },
                              "type": "encryptExpression",
                            },
                            "type": "expression",
                          },
                        ],
                        "type": "messageSendStatement",
                      },
                      "leftId": {
                        "type": "id",
                        "value": "Parent",
                      },
                      "rightId": {
                        "type": "id",
                        "value": "TPM",
                      },
                      "type": "sendStatement",
                    },
                    "comment": {
                      "type": "stmtComment",
                      "value": {
                        "type": "string",
                        "value": "The parent requests the TPM to quote the PCR",
                      },
                    },
                    "type": "statement",
                  },
                  {
                    "child": {
                      "child": {
                        "expressions": [
                          {
                            "child": {
                              "inner": [
                                {
                                  "child": {
                                    "type": "string",
                                    "value": "\\"Quoted\\"",
                                  },
                                  "type": "expression",
                                },
                                {
                                  "child": {
                                    "type": "id",
                                    "value": "pcr",
                                  },
                                  "type": "expression",
                                },
                                {
                                  "child": {
                                    "inner": [
                                      {
                                        "child": {
                                          "type": "id",
                                          "value": "v",
                                        },
                                        "type": "expression",
                                      },
                                    ],
                                    "outer": {
                                      "type": "id",
                                      "value": "k",
                                    },
                                    "type": "encryptExpression",
                                  },
                                  "type": "expression",
                                },
                              ],
                              "outer": {
                                "type": "id",
                                "value": "tpm_sk",
                              },
                              "type": "signExpression",
                            },
                            "type": "expression",
                          },
                        ],
                        "type": "messageSendStatement",
                      },
                      "leftId": {
                        "type": "id",
                        "value": "TPM",
                      },
                      "rightId": {
                        "type": "id",
                        "value": "Parent",
                      },
                      "type": "sendStatement",
                    },
                    "comment": {
                      "type": "stmtComment",
                      "value": {
                        "type": "string",
                        "value": "The TPM sends the PCR and the abilitry value encrypted with the new key to the parent",
                      },
                    },
                    "type": "statement",
                  },
                ],
                "type": "matchCase",
              },
              {
                "case": {
                  "type": "string",
                  "value": "\\"Obtain\\"",
                },
                "children": [
                  {
                    "child": {
                      "child": {
                        "expressions": [
                          {
                            "child": {
                              "inner": [
                                {
                                  "child": {
                                    "type": "string",
                                    "value": "\\"Extend\\"",
                                  },
                                  "type": "expression",
                                },
                                {
                                  "child": {
                                    "type": "string",
                                    "value": "\\"obt\\"",
                                  },
                                  "type": "expression",
                                },
                                {
                                  "child": {
                                    "type": "id",
                                    "value": "sid",
                                  },
                                  "type": "expression",
                                },
                              ],
                              "outer": {
                                "type": "id",
                                "value": "esk",
                              },
                              "type": "encryptExpression",
                            },
                            "type": "expression",
                          },
                        ],
                        "type": "messageSendStatement",
                      },
                      "leftId": {
                        "type": "id",
                        "value": "Parent",
                      },
                      "rightId": {
                        "type": "id",
                        "value": "TPM",
                      },
                      "type": "sendStatement",
                    },
                    "comment": {
                      "type": "stmtComment",
                      "value": {
                        "type": "string",
                        "value": "The parent requests the TPM to extend the PCR with the abilitry value and the session id",
                      },
                    },
                    "type": "statement",
                  },
                  {
                    "child": {
                      "child": {
                        "id": {
                          "type": "id",
                          "value": "pcr",
                        },
                        "type": "setStatement",
                        "value": {
                          "id": "hash",
                          "params": [
                            {
                              "type": "string",
                              "value": "\\"obt\\"",
                            },
                            {
                              "type": "id",
                              "value": "pcr",
                            },
                          ],
                          "type": "function",
                        },
                      },
                      "id": {
                        "type": "id",
                        "value": "TPM",
                      },
                      "type": "participantStatement",
                    },
                    "comment": {
                      "type": "stmtComment",
                      "value": {
                        "type": "string",
                        "value": "The TPM extends the PCR",
                      },
                    },
                    "type": "statement",
                  },
                  {
                    "child": {
                      "child": {
                        "expressions": [
                          {
                            "child": {
                              "type": "string",
                              "value": "\\"Extended\\"",
                            },
                            "type": "expression",
                          },
                          {
                            "child": {
                              "type": "id",
                              "value": "pcr",
                            },
                            "type": "expression",
                          },
                        ],
                        "type": "messageSendStatement",
                      },
                      "leftId": {
                        "type": "id",
                        "value": "TPM",
                      },
                      "rightId": {
                        "type": "id",
                        "value": "Parent",
                      },
                      "type": "sendStatement",
                    },
                    "comment": {
                      "type": "stmtComment",
                      "value": {
                        "type": "string",
                        "value": "The TPM sends the new PCR to the parent",
                      },
                    },
                    "type": "statement",
                  },
                  {
                    "child": {
                      "child": {
                        "expressions": [
                          {
                            "child": {
                              "type": "string",
                              "value": "\\"Decrypt\\"",
                            },
                            "type": "expression",
                          },
                          {
                            "child": {
                              "inner": [
                                {
                                  "child": {
                                    "type": "id",
                                    "value": "v",
                                  },
                                  "type": "expression",
                                },
                              ],
                              "outer": {
                                "type": "id",
                                "value": "k",
                              },
                              "type": "encryptExpression",
                            },
                            "type": "expression",
                          },
                          {
                            "child": {
                              "type": "id",
                              "value": "pcr",
                            },
                            "type": "expression",
                          },
                        ],
                        "type": "messageSendStatement",
                      },
                      "leftId": {
                        "type": "id",
                        "value": "Parent",
                      },
                      "rightId": {
                        "type": "id",
                        "value": "TPM",
                      },
                      "type": "sendStatement",
                    },
                    "comment": {
                      "type": "stmtComment",
                      "value": {
                        "type": "string",
                        "value": "The parent requests the TPM to decrypt the abilitry value",
                      },
                    },
                    "type": "statement",
                  },
                  {
                    "child": {
                      "child": {
                        "expressions": [
                          {
                            "child": {
                              "type": "id",
                              "value": "v",
                            },
                            "type": "expression",
                          },
                        ],
                        "type": "messageSendStatement",
                      },
                      "leftId": {
                        "type": "id",
                        "value": "TPM",
                      },
                      "rightId": {
                        "type": "id",
                        "value": "Parent",
                      },
                      "type": "sendStatement",
                    },
                    "comment": {
                      "type": "stmtComment",
                      "value": {
                        "type": "string",
                        "value": "The TPM sends the abilitry value to the parent",
                      },
                    },
                    "type": "statement",
                  },
                ],
                "type": "matchCase",
              },
            ],
            "type": "matchStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Parent",
          },
          "rightId": {
            "type": "id",
            "value": "TPM",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "The parent now has a choice to either refuse or obtain the abilitry value",
          },
        },
        "type": "statement",
      },
    ],
    "type": "protocol",
  },
  "type": "program",
}
`;

exports[`should parse Needham-Schroeder-Shared-Key.sepo 1`] = `
{
  "equations": undefined,
  "format": {
    "formats": [
      {
        "format": {
          "type": "latex",
          "value": "$K_{A,s}$",
        },
        "id": {
          "type": "id",
          "value": "kas",
        },
        "type": "formatItem",
      },
      {
        "format": {
          "type": "latex",
          "value": "$K_{B,s}$",
        },
        "id": {
          "type": "id",
          "value": "kbs",
        },
        "type": "formatItem",
      },
      {
        "format": {
          "type": "latex",
          "value": "$K_{A,B}$",
        },
        "id": {
          "type": "id",
          "value": "Kab",
        },
        "type": "formatItem",
      },
      {
        "format": {
          "type": "latex",
          "value": "$N_{A}$",
        },
        "id": {
          "type": "id",
          "value": "NA",
        },
        "type": "formatItem",
      },
      {
        "format": {
          "type": "latex",
          "value": "$N_{B}$",
        },
        "id": {
          "type": "id",
          "value": "NB",
        },
        "type": "formatItem",
      },
      {
        "format": {
          "type": "latex",
          "value": "$N_{B} - 1$",
        },
        "id": {
          "id": "subtract",
          "params": [
            {
              "type": "id",
              "value": "NB",
            },
            {
              "type": "number",
              "value": 1,
            },
          ],
          "type": "function",
        },
        "type": "formatItem",
      },
    ],
    "type": "format",
  },
  "functions": undefined,
  "icons": {
    "icons": Map {
      "A" => "woman",
      "B" => "man",
      "s" => "save",
      "kas" => "üîë",
      "kbs" => "üîë",
      "Kab" => "üîë",
      "NA" => "input-numbers",
      "NB" => "input-numbers",
    },
    "type": "icons",
  },
  "keyRelations": undefined,
  "knowledge": {
    "knowledge": [
      {
        "children": [
          {
            "comment": {
              "type": "stmtComment",
              "value": {
                "type": "string",
                "value": "Shared key between Alice and Server",
              },
            },
            "value": {
              "type": "id",
              "value": "kas",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "A",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": {
              "type": "stmtComment",
              "value": {
                "type": "string",
                "value": "Shared key between Bob and Server",
              },
            },
            "value": {
              "type": "id",
              "value": "kbs",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "B",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": {
              "type": "stmtComment",
              "value": {
                "type": "string",
                "value": "Shared key between Alice and Server",
              },
            },
            "value": {
              "type": "id",
              "value": "kas",
            },
          },
          {
            "comment": {
              "type": "stmtComment",
              "value": {
                "type": "string",
                "value": "Shared key between Bob and Server",
              },
            },
            "value": {
              "type": "id",
              "value": "kbs",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "s",
        },
        "type": "knowledgeItem",
      },
    ],
    "type": "knowledge",
  },
  "participants": {
    "participants": [
      {
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Alice",
          },
        },
        "id": {
          "type": "id",
          "value": "A",
        },
        "type": "participantItem",
      },
      {
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Bob",
          },
        },
        "id": {
          "type": "id",
          "value": "B",
        },
        "type": "participantItem",
      },
      {
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Server",
          },
        },
        "id": {
          "type": "id",
          "value": "s",
        },
        "type": "participantItem",
      },
    ],
    "type": "participants",
  },
  "protocol": {
    "statements": [
      {
        "child": {
          "child": {
            "comment": {
              "type": "stmtComment",
              "value": {
                "type": "string",
                "value": "Alice nonce",
              },
            },
            "type": "newStatement",
            "value": {
              "type": "id",
              "value": "NA",
            },
          },
          "id": {
            "type": "id",
            "value": "A",
          },
          "type": "participantStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Alice creates a nonce",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "id",
                  "value": "A",
                },
                "type": "expression",
              },
              {
                "child": {
                  "type": "id",
                  "value": "B",
                },
                "type": "expression",
              },
              {
                "child": {
                  "type": "id",
                  "value": "NA",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "A",
          },
          "rightId": {
            "type": "id",
            "value": "s",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Alice sends her, Bob, and the nonce to the server",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "comment": {
              "type": "stmtComment",
              "value": {
                "type": "string",
                "value": "Shared key between Alice and Bob",
              },
            },
            "type": "newStatement",
            "value": {
              "type": "id",
              "value": "Kab",
            },
          },
          "id": {
            "type": "id",
            "value": "s",
          },
          "type": "participantStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Server creates a shared key",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "id",
                        "value": "Kab",
                      },
                      "type": "expression",
                    },
                    {
                      "child": {
                        "type": "id",
                        "value": "B",
                      },
                      "type": "expression",
                    },
                    {
                      "child": {
                        "type": "id",
                        "value": "NA",
                      },
                      "type": "expression",
                    },
                    {
                      "child": {
                        "inner": [
                          {
                            "child": {
                              "type": "id",
                              "value": "Kab",
                            },
                            "type": "expression",
                          },
                          {
                            "child": {
                              "type": "id",
                              "value": "A",
                            },
                            "type": "expression",
                          },
                        ],
                        "outer": {
                          "type": "id",
                          "value": "kbs",
                        },
                        "type": "encryptExpression",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "kas",
                  },
                  "type": "encryptExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "s",
          },
          "rightId": {
            "type": "id",
            "value": "A",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Server sends Bob, the nonce, and the shared key encrypted with the shared key to Alice",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "id",
                        "value": "Kab",
                      },
                      "type": "expression",
                    },
                    {
                      "child": {
                        "type": "id",
                        "value": "A",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "kbs",
                  },
                  "type": "encryptExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "A",
          },
          "rightId": {
            "type": "id",
            "value": "B",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Alice sends the shared key encrypted with the shared key to Bob",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "comment": {
              "type": "stmtComment",
              "value": {
                "type": "string",
                "value": "Bob nonce",
              },
            },
            "type": "newStatement",
            "value": {
              "type": "id",
              "value": "NB",
            },
          },
          "id": {
            "type": "id",
            "value": "B",
          },
          "type": "participantStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Bob creates a nonce",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "id",
                        "value": "NB",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "Kab",
                  },
                  "type": "encryptExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "B",
          },
          "rightId": {
            "type": "id",
            "value": "A",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Bob sends the nonce encrypted with the shared key to Alice",
          },
        },
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "id": "subtract",
                        "params": [
                          {
                            "type": "id",
                            "value": "NB",
                          },
                          {
                            "type": "number",
                            "value": 1,
                          },
                        ],
                        "type": "function",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "Kab",
                  },
                  "type": "encryptExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "A",
          },
          "rightId": {
            "type": "id",
            "value": "B",
          },
          "type": "sendStatement",
        },
        "comment": {
          "type": "stmtComment",
          "value": {
            "type": "string",
            "value": "Alice performs a simple operation on the nonce, re-encrypts it and sends it back verifying that she is still alive and that she holds the key.",
          },
        },
        "type": "statement",
      },
    ],
    "type": "protocol",
  },
  "type": "program",
}
`;

exports[`should parse TLS-1.3.sepo 1`] = `
{
  "equations": {
    "equations": [
      {
        "left": {
          "id": "add",
          "params": [
            {
              "type": "id",
              "value": "a",
            },
            {
              "type": "id",
              "value": "b",
            },
          ],
          "type": "function",
        },
        "right": {
          "id": "add",
          "params": [
            {
              "type": "id",
              "value": "b",
            },
            {
              "type": "id",
              "value": "a",
            },
          ],
          "type": "function",
        },
        "type": "equation",
      },
    ],
    "type": "equations",
  },
  "format": {
    "formats": [
      {
        "format": {
          "type": "latex",
          "value": "$Hash(x||y)$",
        },
        "id": {
          "id": "hash",
          "params": [
            {
              "type": "id",
              "value": "x",
            },
            {
              "type": "id",
              "value": "y",
            },
          ],
          "type": "function",
        },
        "type": "formatItem",
      },
      {
        "format": {
          "type": "latex",
          "value": "\${a + b}$",
        },
        "id": {
          "id": "add",
          "params": [
            {
              "type": "id",
              "value": "a",
            },
            {
              "type": "id",
              "value": "b",
            },
          ],
          "type": "function",
        },
        "type": "formatItem",
      },
      {
        "format": {
          "type": "latex",
          "value": "$\\\\text{random bytes}_{client}$",
        },
        "id": {
          "type": "id",
          "value": "clientRandomBytes",
        },
        "type": "formatItem",
      },
    ],
    "type": "format",
  },
  "functions": {
    "functions": [
      {
        "type": "id",
        "value": "hash",
      },
    ],
    "type": "functionsDef",
  },
  "icons": {
    "icons": Map {
      "Client" => "laptop",
      "serverSk" => "üîë",
      "serverPk" => "üîë",
      "pmk" => "üîë",
      "supportedCipherSuites" => "üìù",
      "supportedExtensions" => "üìù",
      "cipserSuite" => "üìù",
      "clientRandomBytes" => "üìù",
      "serverRandomBytes" => "üìù",
      "extension" => "üìù",
      "TLSVersion" => "input-numbers",
      "Server" => "home-button",
    },
    "type": "icons",
  },
  "keyRelations": {
    "keyRelations": [
      {
        "pk": {
          "type": "id",
          "value": "serverPk",
        },
        "sk": {
          "type": "id",
          "value": "serverSk",
        },
        "type": "keyRelation",
      },
    ],
    "type": "keyRelations",
  },
  "knowledge": {
    "knowledge": [
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "TLSVersion",
            },
          },
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "supportedCipherSuites",
            },
          },
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "supportedExtensions",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Client",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": {
              "type": "stmtComment",
              "value": {
                "type": "string",
                "value": "Server private key",
              },
            },
            "value": {
              "type": "id",
              "value": "serverSk",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Server",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": {
              "type": "stmtComment",
              "value": {
                "type": "string",
                "value": "Server public key",
              },
            },
            "value": {
              "type": "id",
              "value": "serverPk",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Shared",
        },
        "type": "knowledgeItem",
      },
    ],
    "type": "knowledge",
  },
  "participants": {
    "participants": [
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Client",
        },
        "type": "participantItem",
      },
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Server",
        },
        "type": "participantItem",
      },
    ],
    "type": "participants",
  },
  "protocol": {
    "statements": [
      {
        "child": {
          "child": {
            "comment": undefined,
            "type": "newStatement",
            "value": {
              "type": "id",
              "value": "clientRandomBytes",
            },
          },
          "id": {
            "type": "id",
            "value": "Client",
          },
          "type": "participantStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "string",
                  "value": "\\"Client Hello\\"",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Client",
          },
          "rightId": {
            "type": "id",
            "value": "Server",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "id",
                  "value": "TLSVersion",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Client",
          },
          "rightId": {
            "type": "id",
            "value": "Server",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "id",
                  "value": "clientRandomBytes",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Client",
          },
          "rightId": {
            "type": "id",
            "value": "Server",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "id",
                  "value": "supportedCipherSuites",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Client",
          },
          "rightId": {
            "type": "id",
            "value": "Server",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "id",
                  "value": "supportedExtensions",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Client",
          },
          "rightId": {
            "type": "id",
            "value": "Server",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "comment": undefined,
            "type": "newStatement",
            "value": {
              "type": "id",
              "value": "cipserSuite",
            },
          },
          "id": {
            "type": "id",
            "value": "Server",
          },
          "type": "participantStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "comment": undefined,
            "type": "newStatement",
            "value": {
              "type": "id",
              "value": "serverRandomBytes",
            },
          },
          "id": {
            "type": "id",
            "value": "Server",
          },
          "type": "participantStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "comment": undefined,
            "type": "newStatement",
            "value": {
              "type": "id",
              "value": "extension",
            },
          },
          "id": {
            "type": "id",
            "value": "Server",
          },
          "type": "participantStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "string",
                        "value": "\\"Server Hello\\"",
                      },
                      "type": "expression",
                    },
                    {
                      "child": {
                        "type": "id",
                        "value": "cipserSuite",
                      },
                      "type": "expression",
                    },
                    {
                      "child": {
                        "type": "id",
                        "value": "serverRandomBytes",
                      },
                      "type": "expression",
                    },
                    {
                      "child": {
                        "type": "id",
                        "value": "extension",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "serverPk",
                  },
                  "type": "signExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Server",
          },
          "rightId": {
            "type": "id",
            "value": "Client",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "comment": {
              "type": "stmtComment",
              "value": {
                "type": "string",
                "value": "Pre-master-key",
              },
            },
            "type": "newStatement",
            "value": {
              "type": "id",
              "value": "pmk",
            },
          },
          "id": {
            "type": "id",
            "value": "Client",
          },
          "type": "participantStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "id": {
              "type": "id",
              "value": "pmk",
            },
            "type": "setStatement",
            "value": {
              "id": "add",
              "params": [
                {
                  "type": "id",
                  "value": "clientRandomBytes",
                },
                {
                  "type": "id",
                  "value": "serverRandomBytes",
                },
              ],
              "type": "function",
            },
          },
          "id": {
            "type": "id",
            "value": "Client",
          },
          "type": "participantStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
    ],
    "type": "protocol",
  },
  "type": "program",
}
`;

exports[`should parse icon-test.sepo 1`] = `
{
  "equations": undefined,
  "format": undefined,
  "functions": undefined,
  "icons": {
    "icons": Map {
      "Alice" => "woman",
      "Bob" => "man",
      "B_sk" => "üîë",
      "B_pk" => "üîë",
      "msg_A" => "üìù",
    },
    "type": "icons",
  },
  "keyRelations": undefined,
  "knowledge": {
    "knowledge": [
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "B_sk",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "B_pk",
            },
          },
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "msg_A",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "knowledgeItem",
      },
    ],
    "type": "knowledge",
  },
  "participants": {
    "participants": [
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "participantItem",
      },
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "participantItem",
      },
    ],
    "type": "participants",
  },
  "protocol": {
    "statements": [
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "id",
                        "value": "msg_A",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "B_pk",
                  },
                  "type": "encryptExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Alice",
          },
          "rightId": {
            "type": "id",
            "value": "Bob",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
    ],
    "type": "protocol",
  },
  "type": "program",
}
`;

exports[`should parse key-relation.sepo 1`] = `
{
  "equations": undefined,
  "format": undefined,
  "functions": undefined,
  "icons": undefined,
  "keyRelations": {
    "keyRelations": [
      {
        "pk": {
          "type": "id",
          "value": "B_pk",
        },
        "sk": {
          "type": "id",
          "value": "B_sk",
        },
        "type": "keyRelation",
      },
    ],
    "type": "keyRelations",
  },
  "knowledge": {
    "knowledge": [
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "B_sk",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "B_pk",
            },
          },
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "msg_A",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "knowledgeItem",
      },
    ],
    "type": "knowledge",
  },
  "participants": {
    "participants": [
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "participantItem",
      },
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "participantItem",
      },
    ],
    "type": "participants",
  },
  "protocol": {
    "statements": [
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "id",
                        "value": "msg_A",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "B_pk",
                  },
                  "type": "encryptExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Alice",
          },
          "rightId": {
            "type": "id",
            "value": "Bob",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
    ],
    "type": "protocol",
  },
  "type": "program",
}
`;

exports[`should parse new_function.sepo 1`] = `
{
  "equations": undefined,
  "format": undefined,
  "functions": {
    "functions": [
      {
        "type": "id",
        "value": "hash",
      },
    ],
    "type": "functionsDef",
  },
  "icons": undefined,
  "keyRelations": undefined,
  "knowledge": undefined,
  "participants": {
    "participants": [
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "participantItem",
      },
    ],
    "type": "participants",
  },
  "protocol": {
    "statements": [
      {
        "child": {
          "child": {
            "comment": undefined,
            "type": "newStatement",
            "value": {
              "id": "hash",
              "params": [
                {
                  "type": "id",
                  "value": "x",
                },
                {
                  "type": "id",
                  "value": "y",
                },
              ],
              "type": "function",
            },
          },
          "id": {
            "type": "id",
            "value": "Alice",
          },
          "type": "participantStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
    ],
    "type": "protocol",
  },
  "type": "program",
}
`;

exports[`should parse send.sepo 1`] = `
{
  "equations": undefined,
  "format": undefined,
  "functions": undefined,
  "icons": undefined,
  "keyRelations": undefined,
  "knowledge": {
    "knowledge": [
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "msg_B",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "msg_A",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "knowledgeItem",
      },
    ],
    "type": "knowledge",
  },
  "participants": {
    "participants": [
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "participantItem",
      },
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "participantItem",
      },
    ],
    "type": "participants",
  },
  "protocol": {
    "statements": [
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "id",
                  "value": "msg_A",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Alice",
          },
          "rightId": {
            "type": "id",
            "value": "Bob",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "id",
                  "value": "msg_B",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Bob",
          },
          "rightId": {
            "type": "id",
            "value": "Alice",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
    ],
    "type": "protocol",
  },
  "type": "program",
}
`;

exports[`should parse send-and-clear.sepo 1`] = `
{
  "equations": undefined,
  "format": undefined,
  "functions": undefined,
  "icons": undefined,
  "keyRelations": undefined,
  "knowledge": {
    "knowledge": [
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "msg_B",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "msg_A",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "knowledgeItem",
      },
    ],
    "type": "knowledge",
  },
  "participants": {
    "participants": [
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "participantItem",
      },
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "participantItem",
      },
    ],
    "type": "participants",
  },
  "protocol": {
    "statements": [
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "id",
                  "value": "msg_A",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Alice",
          },
          "rightId": {
            "type": "id",
            "value": "Bob",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "id",
                  "value": "msg_B",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Bob",
          },
          "rightId": {
            "type": "id",
            "value": "Alice",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "id": {
            "type": "id",
            "value": "msg_A",
          },
          "type": "clearStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "id": {
            "type": "id",
            "value": "msg_B",
          },
          "type": "clearStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
    ],
    "type": "protocol",
  },
  "type": "program",
}
`;

exports[`should parse send-encryption-no-decrypt.sepo 1`] = `
{
  "equations": undefined,
  "format": undefined,
  "functions": undefined,
  "icons": undefined,
  "keyRelations": undefined,
  "knowledge": {
    "knowledge": [
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "bkey",
            },
          },
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "msg_B",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "akey",
            },
          },
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "msg_A",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "knowledgeItem",
      },
    ],
    "type": "knowledge",
  },
  "participants": {
    "participants": [
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "participantItem",
      },
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "participantItem",
      },
    ],
    "type": "participants",
  },
  "protocol": {
    "statements": [
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "id",
                        "value": "msg_A",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "aKey",
                  },
                  "type": "encryptExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Alice",
          },
          "rightId": {
            "type": "id",
            "value": "Bob",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "id",
                        "value": "msg_B",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "bKey",
                  },
                  "type": "encryptExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Bob",
          },
          "rightId": {
            "type": "id",
            "value": "Alice",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
    ],
    "type": "protocol",
  },
  "type": "program",
}
`;

exports[`should parse send-with-enc.sepo 1`] = `
{
  "equations": undefined,
  "format": undefined,
  "functions": undefined,
  "icons": undefined,
  "keyRelations": undefined,
  "knowledge": {
    "knowledge": [
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "key",
            },
          },
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "msg_B",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "key",
            },
          },
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "msg_A",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "knowledgeItem",
      },
    ],
    "type": "knowledge",
  },
  "participants": {
    "participants": [
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "participantItem",
      },
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "participantItem",
      },
    ],
    "type": "participants",
  },
  "protocol": {
    "statements": [
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "id",
                        "value": "msg_A",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "key",
                  },
                  "type": "encryptExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Alice",
          },
          "rightId": {
            "type": "id",
            "value": "Bob",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "id",
                        "value": "msg_B",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "key",
                  },
                  "type": "encryptExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Bob",
          },
          "rightId": {
            "type": "id",
            "value": "Alice",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
    ],
    "type": "protocol",
  },
  "type": "program",
}
`;

exports[`should parse send-with-sign.sepo 1`] = `
{
  "equations": undefined,
  "format": undefined,
  "functions": undefined,
  "icons": undefined,
  "keyRelations": undefined,
  "knowledge": {
    "knowledge": [
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "msg_B",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "msg_A",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "knowledgeItem",
      },
    ],
    "type": "knowledge",
  },
  "participants": {
    "participants": [
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "participantItem",
      },
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "participantItem",
      },
    ],
    "type": "participants",
  },
  "protocol": {
    "statements": [
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "id",
                        "value": "msg_A",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "key",
                  },
                  "type": "signExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Alice",
          },
          "rightId": {
            "type": "id",
            "value": "Bob",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "inner": [
                    {
                      "child": {
                        "type": "id",
                        "value": "msg_B",
                      },
                      "type": "expression",
                    },
                  ],
                  "outer": {
                    "type": "id",
                    "value": "key",
                  },
                  "type": "signExpression",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Bob",
          },
          "rightId": {
            "type": "id",
            "value": "Alice",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
    ],
    "type": "protocol",
  },
  "type": "program",
}
`;

exports[`should parse simple.sepo 1`] = `
{
  "equations": {
    "equations": [
      {
        "left": {
          "id": "add",
          "params": [
            {
              "type": "id",
              "value": "a",
            },
            {
              "type": "id",
              "value": "b",
            },
          ],
          "type": "function",
        },
        "right": {
          "id": "add",
          "params": [
            {
              "type": "id",
              "value": "b",
            },
            {
              "type": "id",
              "value": "a",
            },
          ],
          "type": "function",
        },
        "type": "equation",
      },
    ],
    "type": "equations",
  },
  "format": {
    "formats": [
      {
        "format": {
          "type": "latex",
          "value": "$Hash(x||y)$",
        },
        "id": {
          "id": "hash",
          "params": [
            {
              "type": "id",
              "value": "x",
            },
            {
              "type": "id",
              "value": "y",
            },
          ],
          "type": "function",
        },
        "type": "formatItem",
      },
      {
        "format": {
          "type": "latex",
          "value": "$g^{y}$",
        },
        "id": {
          "id": "exp",
          "params": [
            {
              "type": "id",
              "value": "g",
            },
            {
              "type": "id",
              "value": "y",
            },
          ],
          "type": "function",
        },
        "type": "formatItem",
      },
      {
        "format": {
          "type": "latex",
          "value": "$function(x,y,x)$",
        },
        "id": {
          "id": "fun",
          "params": [
            {
              "type": "id",
              "value": "x",
            },
            {
              "type": "id",
              "value": "y",
            },
          ],
          "type": "function",
        },
        "type": "formatItem",
      },
    ],
    "type": "format",
  },
  "functions": {
    "functions": [
      {
        "type": "id",
        "value": "hash",
      },
    ],
    "type": "functionsDef",
  },
  "icons": undefined,
  "keyRelations": {
    "keyRelations": [
      {
        "pk": {
          "type": "id",
          "value": "tpm_pk",
        },
        "sk": {
          "type": "id",
          "value": "tmp_sk",
        },
        "type": "keyRelation",
      },
    ],
    "type": "keyRelations",
  },
  "knowledge": {
    "knowledge": [
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "tpm_sk",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "TPM",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "tpm_pk",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Shared",
        },
        "type": "knowledgeItem",
      },
    ],
    "type": "knowledge",
  },
  "participants": {
    "participants": [
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "participantItem",
      },
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Parent",
        },
        "type": "participantItem",
      },
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "TPM",
        },
        "type": "participantItem",
      },
    ],
    "type": "participants",
  },
  "protocol": {
    "statements": [
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "id",
                  "value": "tpm_sk",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "TPM",
          },
          "rightId": {
            "type": "id",
            "value": "Alice",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "id": "hash",
                  "params": [
                    {
                      "type": "id",
                      "value": "x",
                    },
                    {
                      "id": "exp",
                      "params": [
                        {
                          "type": "id",
                          "value": "g",
                        },
                        {
                          "type": "id",
                          "value": "y",
                        },
                      ],
                      "type": "function",
                    },
                  ],
                  "type": "function",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Alice",
          },
          "rightId": {
            "type": "id",
            "value": "TPM",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
    ],
    "type": "protocol",
  },
  "type": "program",
}
`;

exports[`should parse simple_match.sepo 1`] = `
{
  "equations": undefined,
  "format": undefined,
  "functions": undefined,
  "icons": {
    "icons": Map {
      "Alice" => "woman",
      "Bob" => "man",
    },
    "type": "icons",
  },
  "keyRelations": undefined,
  "knowledge": {
    "knowledge": [
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "akey",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "knowledgeItem",
      },
      {
        "children": [
          {
            "comment": undefined,
            "value": {
              "type": "id",
              "value": "bkey",
            },
          },
        ],
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "knowledgeItem",
      },
    ],
    "type": "knowledge",
  },
  "participants": {
    "participants": [
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Alice",
        },
        "type": "participantItem",
      },
      {
        "comment": undefined,
        "id": {
          "type": "id",
          "value": "Bob",
        },
        "type": "participantItem",
      },
    ],
    "type": "participants",
  },
  "protocol": {
    "statements": [
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "id",
                  "value": "akey",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Alice",
          },
          "rightId": {
            "type": "id",
            "value": "Bob",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "cases": [
              {
                "case": {
                  "type": "string",
                  "value": "\\"Refuse\\"",
                },
                "children": [
                  {
                    "child": {
                      "child": {
                        "expressions": [
                          {
                            "child": {
                              "type": "string",
                              "value": "\\"Refused\\"",
                            },
                            "type": "expression",
                          },
                        ],
                        "type": "messageSendStatement",
                      },
                      "leftId": {
                        "type": "id",
                        "value": "Bob",
                      },
                      "rightId": {
                        "type": "id",
                        "value": "Alice",
                      },
                      "type": "sendStatement",
                    },
                    "comment": undefined,
                    "type": "statement",
                  },
                ],
                "type": "matchCase",
              },
              {
                "case": {
                  "type": "string",
                  "value": "\\"Obtain\\"",
                },
                "children": [
                  {
                    "child": {
                      "child": {
                        "expressions": [
                          {
                            "child": {
                              "type": "string",
                              "value": "\\"Obtained\\"",
                            },
                            "type": "expression",
                          },
                        ],
                        "type": "messageSendStatement",
                      },
                      "leftId": {
                        "type": "id",
                        "value": "Bob",
                      },
                      "rightId": {
                        "type": "id",
                        "value": "Alice",
                      },
                      "type": "sendStatement",
                    },
                    "comment": undefined,
                    "type": "statement",
                  },
                ],
                "type": "matchCase",
              },
            ],
            "type": "matchStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Bob",
          },
          "rightId": {
            "type": "id",
            "value": "Alice",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
      {
        "child": {
          "child": {
            "expressions": [
              {
                "child": {
                  "type": "id",
                  "value": "bkey",
                },
                "type": "expression",
              },
            ],
            "type": "messageSendStatement",
          },
          "leftId": {
            "type": "id",
            "value": "Bob",
          },
          "rightId": {
            "type": "id",
            "value": "Alice",
          },
          "type": "sendStatement",
        },
        "comment": undefined,
        "type": "statement",
      },
    ],
    "type": "protocol",
  },
  "type": "program",
}
`;
